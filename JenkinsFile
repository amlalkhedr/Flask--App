pipeline{
    agent any 
    stages {
        stage('prep'){
            steps{
                 git credentialsId: 'github', url: 'https://github.com/wwmezo0/Flask-App.git', branch: 'main'
                    

            }
        }
        
    stage('build'){
        steps {
            withCredentials([usernamePassword(credentialsId:"docker",usernameVariable:"USER",passwordVariable:"PASS")]){
            sh 'docker build ./BucketList-App/FlaskApp/ -t ${USER}/flask'
            sh 'docker logout'
            sh 'docker login -u ${USER} -p ${PASS}'
            sh 'docker push ${USER}/flask'
                
            }
        }
    }
    }
  post {
        success {
            slackSend( // Send a success notification
                channel: '#flask-app', 
                color: 'good',  // Green color for success
                message: "${env.JOB_NAME} is *Build Succeeded* with build no  ${env.BUILD_NUMBER} URL: (<${env.BUILD_URL}|Open>)"
            )
        }
   failure {
            slackSend(             // Send a failure notification
                channel: '#flask-app', 
                color: 'danger',  // Red color for failure
                message:"${env.JOB_NAME} is *Build Failed* with build no  ${env.BUILD_NUMBER} URL: (<${env.BUILD_URL}|Open>)"

            )
        }
}
